import java.net.http.*;
import java.net.URI;
import java.nio.charset.StandardCharsets;
import java.util.Scanner;

public class MiniChat {
  static String KEY = System.getenv("GROQ_API_KEY");

  static String ask(String userMsg) throws Exception {
    String body = """
      {"model":"llama3-8b-8192",
       "messages":[{"role":"user","content":%s}]}
    """.formatted("\"" + userMsg.replace("\"","\\\"") + "\"");

    HttpRequest req = HttpRequest.newBuilder()
      .uri(URI.create("https://api.groq.com/openai/v1/chat/completions"))
      .header("Authorization", "Bearer " + KEY)
      .header("Content-Type", "application/json")
      .POST(HttpRequest.BodyPublishers.ofString(body, StandardCharsets.UTF_8))
      .build();

    HttpResponse<String> res =
      HttpClient.newHttpClient().send(req, HttpResponse.BodyHandlers.ofString());
    return res.body();
  }

  public static void main(String[] args) throws Exception {
    Scanner sc = new Scanner(System.in);
    System.out.println("MiniChat (type 'quit' to exit)");
    for(;;){
      System.out.print("You: ");
      String q = sc.nextLine();
      if(q.equalsIgnoreCase("quit")) break;
      System.out.println("Bot: " + ask(q));
}
}
}
